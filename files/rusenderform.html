<style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap");

    .subscribe-form * {
        box-sizing: border-box;
    }

    .subscribe-form-close {
        position: absolute;
        top: 24px;
        right: 24px;
        box-shadow: 0 0 5px rgba(10, 22, 65, 0.04),
        0 4px 16px rgba(16, 33, 84, 0.1);
        border-radius: 100%;
        transition: all 0.2s ease;
        cursor: pointer;

        display: none;
    }

    .subscribe-form-close:hover {
        opacity: 0.8;
    }

    .subscribe-form-expandingWindow-container {
        display: flex;
        align-items: center;
        justify-content: center;

        position: fixed;
        left: 0;
        top: 0;
        z-index: 2147483647;

        width: 100%;
        height: 100%;

        transition: all 0.2s ease;
        pointer-events: none;
        opacity: 0;
    }

    .subscribe-form-expandingWindow-container .subscribe-form .subscribe-form-close {
        display: block;
    }

    .subscribe-form {
        width: 100%;
        max-width: 450px;
        padding: 32px;
        box-shadow: 0 0 5px rgba(10, 22, 65, 0.04),
        0 8px 32px rgba(16, 33, 84, 0.16);
        border-radius: 32px;
        font-family: "Inter", sans-serif;
        position: relative;
    }

    .subscribe-form .title {
        margin-bottom: 16px;
        text-align: center;
        color: #191942;
    }

    .subscribe-form .text {
        font-weight: 400;
        font-size: 16px;
        line-height: 24px;
        text-align: center;
        margin-bottom: 8px;
        color: #5d5d85;
    }

    .form-group {
        margin-top: 24px;
    }

    .subscribe-form .text:last-child {
        margin-bottom: 0;
    }

    .subscribe-form .submit {
        margin-top: 24px;
        border-radius: 12px;
        padding: 12px;
        font-weight: 600;
        font-size: 16px;
        line-height: 24px;
        border: none;
        outline: none;
        display: block;
        width: 100%;
        transition: opacity 0.2s ease;
        height: unset;
        box-shadow: none;
    }

    .subscribe-form .submit.disabled {
        opacity: 0.75;
        pointer-events: none;
    }

    .input-label {
        color: #5d5d85;
        font-weight: 500;
        font-size: 14px;
        line-height: 20px;
        margin-bottom: 8px;
    }

    .input-label.required:after {
        margin-left: 4px;
        content: "*";
        color: #e52f50;
        font-weight: 500;
        font-size: 14px;
        line-height: 20px;
    }

    .subscribe-form .submit:hover {
        opacity: 0.75;
    }

    .subscribe-form .privacy-policy {
        font-size: 12px;
        opacity: 0.7;
        margin-top: 24px;
        margin-bottom: 0;
        text-align: center;
        color: #5d5d85;
        text-decoration: none;
    }

    .subscribe-form .privacy-policy a {
        text-decoration: none;
    }

    p.privacy-policy:has(a[href=""]) {
        display: none;
    }

    .subscribe-form .textfield {
        width: 100%;
        border: 1.5px solid #e9e9f0;
        border-radius: 12px;
        padding: 8px 12px;
        font-weight: 500;
        font-size: 16px;
        line-height: 24px;
        outline: none;
        transition: all 0.2s ease;
        text-overflow: ellipsis;
        cursor: text;
        background-color: #fff;

        box-shadow: none;
        height: unset;
    }

    .subscribe-form .textfield::placeholder {
        color: inherit;
        opacity: 0.6;
    }

    .subscribe-form .textfield:hover {
        border-color: #d4d4e1;
    }

    .subscribe-form .textfield:focus {
        border-color: #4b4afb;
    }

    .subscribe-form .textfield.error,
    .subscribe-form .textfield.error:focus {
        border-color: #e52f50;
    }

    .privacy-policy {
        margin-top: 24px;
    }

    .subscribe-form-submitted {
        display: none;
    }
</style>
<script>
  const config = {
    type: "expandingWindow",
    showAgain: "dontShow",
    showAgainPeriod: "day",
    showAgainPeriodValue: "1",
    whenShowForm: "onLoad",
    whenShowFormPeriod: "seconds",
    whenShowFormPeriodValue: "10"
  };

  const submitForm = (e, subscribeFormIndex) => {
    e.preventDefault();

    const subscribeForm = document.querySelectorAll(
      ".subscribe-form"
    )[subscribeFormIndex];
    const formData = new FormData(subscribeForm);
    const formDataJson = Object.fromEntries(formData.entries());

    if (validateForm(subscribeFormIndex, false)) {
      fetch(subscribeForm.action, {
        method: "POST",
        mode: "no-cors",
        cache: "no-cache",
        credentials: "same-origin",
        headers: {
          "content-type": "application/x-www-form-urlencoded",
        },
        redirect: "follow",
        referrerPolicy: "no-referrer",
        body: JSON.stringify(formDataJson),
      }).finally(() => {
        subscribeForm
          .querySelector(".subscribe-form-ready")
          .setAttribute("style", "display: none");
        subscribeForm
          .querySelector(".subscribe-form-submitted")
          .setAttribute("style", "display: block");
      });

      if (config.type === "expandingWindow" && config.showAgain !== 'show')
        setCloseDate()
    }
  };

  const validateForm = (subscribeFormIndex, silent = false) => {
    const subscribeForm = document.querySelectorAll(
      ".subscribe-form"
    )[subscribeFormIndex];
    const submitButton = subscribeForm.querySelector(".submit");

    setSubmit(true, subscribeFormIndex);
    subscribeForm.querySelectorAll("input").forEach((el) => {
      if (!validateInput(el, subscribeFormIndex, silent)) {
        setSubmit(false, subscribeFormIndex);
      }
    });

    return !(submitButton.classList.contains("disabled") && !silent);
  };

  const validateInput = (el, subscribeFormIndex, silent = false) => {
    const emailRegex = /^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/g;
    const phoneRegex = /^\+?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{2,6}$/im;

    if (el.classList.contains("required") && el.value === "") {
      if (!silent && !el.classList.contains("error"))
        el.classList.toggle("error");

      setSubmit(false, subscribeFormIndex);
      return false;
    }

    if (
      (el.type === "email" && !emailRegex.test(el.value)) ||
      (el.type === "tel" &&
        !phoneRegex.test(el.value) &&
        el.classList.contains("required"))
    ) {
      if (!silent && !el.classList.contains("error"))
        el.classList.toggle("error");

      setSubmit(false, subscribeFormIndex);
      return false;
    }

    if (el.classList.contains("error")) el.classList.toggle("error");
    return true;
  };

  const setSubmit = (value, subscribeFormIndex) => {
    const subscribeForm = document.querySelectorAll(
      ".subscribe-form"
    )[subscribeFormIndex];
    const submitButton = subscribeForm.querySelector(".submit");

    if (
      (!value && !submitButton.classList.contains("disabled")) ||
      (value && submitButton.classList.contains("disabled"))
    )
      submitButton.classList.toggle("disabled");
  };

  const canShowAgain = () => {
    const closedDateMilliseconds = localStorage.getItem(`${window.location.hostname}-popup`);

    if (!closedDateMilliseconds)
      return true

    if (config.showAgain === 'dontShow')
      return false

    const closedDate = new Date(parseInt(closedDateMilliseconds));

    const dayDifferenceMilliseconds = Date.now() - closedDate.getTime();
    const dayDifference = dayDifferenceMilliseconds / (1000 * 3600 * 24);

    switch (config.showAgainPeriod) {
      case "day":
        return dayDifference >= config.showAgainPeriodValue
      case "week":
        return dayDifference >= config.showAgainPeriodValue * 7
      case "month":
        return dayDifference >= config.showAgainPeriodValue * 30
      default:
        return dayDifference >= config.showAgainPeriodValue
    }
  }

  function setCloseDate() {
    localStorage.setItem(
      `${window.location.hostname}-popup`,
      Date.now().toString()
    );
  }

  const closeWindow = (subscribeForm) => {
    subscribeForm.parentElement.style.opacity = "0";
    subscribeForm.parentElement.style["pointer-events"] = "none";

    setCloseDate()
  };

  const init = () => {
    document
      .querySelectorAll(".subscribe-form")
      .forEach((subscribeForm, subscribeFormIndex) => {
        subscribeForm.querySelector(".subscribe-form-close").onclick =
          () => closeWindow(subscribeForm);

        subscribeForm.querySelectorAll("input").forEach((formInput) => {
          formInput.addEventListener("input", (e) => {
            validateInput(e.target, subscribeFormIndex);
            validateForm(subscribeFormIndex, true);
          });
          formInput.addEventListener("focusout", (e) => {
            validateInput(e.target, subscribeFormIndex);
            validateForm(subscribeFormIndex, true);
          });
        });

        subscribeForm.addEventListener("submit", (e) =>
          submitForm(e, subscribeFormIndex)
        );
        
        // Скрытие p.privacy-policy при отсутствии валидной ссылки
        subscribeForm.querySelectorAll("p.privacy-policy").forEach((policy) => {
          const link = policy.querySelector("a");
          if (link) {
            const href = link.getAttribute("href");
            if (!href || href.includes("privacyPolicyLink")) {
              policy.style.display = "none";
            }
          }
        });
      });

    if (config.type !== "expandingWindow")
      return;

    switch (config.whenShowForm) {
      case "onLoad":
        if (!canShowAgain())
          return;

        document
          .querySelectorAll(".subscribe-form-expandingWindow-container")
          .forEach((subscribeForm) => {
            subscribeForm.style.opacity = "1";
            subscribeForm.style["pointer-events"] = "all";
          });
        break;
      case "withDelay":
        if (!canShowAgain())
          return;

        if (config.whenShowFormPeriod === "minutes") {
          setTimeout(
            () =>
              document
                .querySelectorAll(".subscribe-form-expandingWindow-container")
                .forEach((subscribeForm) => {
                  subscribeForm.style.opacity = "1";
                  subscribeForm.style["pointer-events"] = "all";
                }),
            config.whenShowFormPeriodValue * 60 * 1000
          );
          return;
        }
        setTimeout(
          () =>
            document
              .querySelectorAll(".subscribe-form-expandingWindow-container")
              .forEach((subscribeForm) => {
                subscribeForm.style.opacity = "1";
                subscribeForm.style["pointer-events"] = "all";
              }),
          config.whenShowFormPeriodValue * 1000
        );
        break
      case "onClose":
        document.onmouseleave = () => {
          if (!canShowAgain())
            document
              .querySelectorAll(".subscribe-form-expandingWindow-container")
              .forEach((subscribeForm) => {
                subscribeForm.style.opacity = "1";
                subscribeForm.style["pointer-events"] = "all";
              })
        }
    }
  };
  if (document.readyState === "complete") {
  	init();
  } else {
    window.addEventListener("load", init);
  }
  
</script>
<div class="subscribe-form-expandingWindow-container">
  <form
    class="subscribe-form"
    action="https://form.sender-click.net/api/v1/subscribe-form/create?hash=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZEZvcm0iOjMyMTcsImlkVXNlciI6MTc1NzAsImlkR3JvdXBDb250YWN0cyI6Mjg3NDgsImlhdCI6MTc2MjExNDY4OX0.Y3W-YQPD4U2J2QVQ3Kn7rLvsHv36f8U4SktJUQgdJaQ"
    charset="UTF-8"
    method="post"
    style="
      background-color: #fff
    "
  >
    <div class="subscribe-form-ready">
      <h3 class="title" style="color: #191942 !important">Присоединяйтесь к нам</h3>

      <div class="text" style="color: #5d5d85 !important">Подпишитесь на рассылку сегодня и узнавайте о новых курсах, видео и инструментах на сайте</div>

      <div class="form-group">
        <div class="input-label required" style="color: #5d5d85 ">Email</div>

        <input
          maxlength="255"
          name="email"
          type="email"
          class="textfield required"
          style=" color: #333 !important "
          placeholder="Введите email"
        />
      </div>

      <button
        class="submit"
        style="
            background-color: #6171E2FF !important;
            color: #fff !important"
      >
        Подписаться
      </button>

      <p class="privacy-policy" style="color: #5d5d85 !important;">
        Нажимая на кнопку, вы даете согласие на обработку своих персональных
        данных согласно 152-ФЗ.
        <a
          style="color: #5d5d85 !important;"
          href="{{privacyPolicyLink}}"
        ><b>Подробнее</b></a
        >
      </p>
    </div>

    <div class="subscribe-form-submitted">
      <h3 class="title" style="color: #191942 !important">Спасибо!</h3>

      <div class="text" style="color: #5d5d85 !important">Мы отправили письмо на ваш адрес. Перейдите по указанной в нем ссылке для подтверждения подписки.</div>
    </div>

    <svg
      class="subscribe-form-close"
      width="32"
      height="32"
      viewBox="0 0 32 32"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle opacity="0.4" cx="16" cy="16" r="16" fill="white" />
      <path
        d="M22 10L10 22"
        stroke="#8E8EAD"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M22 22L10 10"
        stroke="#8E8EAD"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
  </form>
</div>
